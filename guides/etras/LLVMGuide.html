<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Every Developer's Guide to LLVM</title>
    <meta name="description" content="A comprehensive guide to the LLVM compiler infrastructure, tools, and its integration with Delphi.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom scrollbar for sidebar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Code block styling */
        pre {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Typography enhancements */
        .prose h1 { @apply text-4xl font-extrabold text-slate-900 mb-6 tracking-tight; }
        .prose h2 { @apply text-2xl font-bold text-slate-800 mt-10 mb-4 border-b border-slate-200 pb-2; }
        .prose h3 { @apply text-xl font-semibold text-slate-700 mt-8 mb-3; }
        .prose h4 { @apply text-lg font-semibold text-slate-700 mt-6 mb-2; }
        .prose p { @apply text-slate-600 leading-7 mb-4; }
        .prose ul { @apply list-disc list-outside ml-6 text-slate-600 mb-4; }
        .prose li { @apply mb-1; }
        .prose a { @apply text-blue-600 hover:text-blue-800 underline decoration-blue-300 hover:decoration-blue-800 transition-colors; }
        .prose blockquote { @apply border-l-4 border-blue-500 pl-4 italic bg-slate-50 py-2 my-4 rounded-r; }
        
        /* Table styling */
        .prose table { @apply min-w-full divide-y divide-slate-200 border border-slate-200 rounded-lg overflow-hidden mb-6; }
        .prose thead { @apply bg-slate-100; }
        .prose th { @apply px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider; }
        .prose tbody { @apply bg-white divide-y divide-slate-200; }
        .prose td { @apply px-6 py-4 whitespace-nowrap text-sm text-slate-600; }

        /* Smooth scrolling adjustment for header offset */
        html {
            scroll-padding-top: 5rem;
        }
    </style>
</head>
<body class="bg-white text-slate-600 font-sans antialiased">

    <!-- Mobile Header -->
    <div class="lg:hidden fixed top-0 left-0 right-0 h-16 bg-white border-b border-slate-200 z-50 flex items-center justify-between px-4">
        <span class="font-bold text-lg text-slate-900">LLVM Guide</span>
        <button id="menu-toggle" class="text-slate-600 hover:text-slate-900 focus:outline-none">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <div class="flex min-h-screen pt-16 lg:pt-0">
        
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 bg-slate-50 border-r border-slate-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col h-full">
            <div class="p-6 border-b border-slate-200 bg-white">
                <h1 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                    <i class="fas fa-dragon text-blue-600"></i> LLVM Guide
                </h1>
                <p class="text-xs text-slate-500 mt-2 uppercase tracking-wide font-semibold">The Universal Backbone</p>
            </div>
            
            <nav class="flex-1 overflow-y-auto custom-scroll p-4 space-y-1">
                <a href="#introduction" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all">1. Introduction</a>
                
                <a href="#core-architecture" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">2. Core Architecture</a>
                <div class="pl-4 space-y-1 border-l-2 border-slate-200 ml-3">
                    <a href="#three-phase-pipeline" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">2.1 The Three-Phase Pipeline</a>
                    <a href="#llvm-ir" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">2.2 The LLVM IR</a>
                    <a href="#optimization-pipeline" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">2.3 Optimization Pipeline</a>
                </div>

                <a href="#toolchain" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">3. The LLVM Toolchain</a>
                <div class="pl-4 space-y-1 border-l-2 border-slate-200 ml-3">
                    <a href="#clang-driver" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">3.1 Clang</a>
                    <a href="#llvm-objdump" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">3.2 llvm-objdump</a>
                    <a href="#opt-tool" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">3.3 Opt</a>
                    <a href="#llc-compiler" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">3.4 LLC</a>
                    <a href="#llvm-link" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">3.5 llvm-link</a>
                </div>

                <a href="#delphi-llvm" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">4. Delphi & LLVM</a>
                <div class="pl-4 space-y-1 border-l-2 border-slate-200 ml-3">
                    <a href="#nextgen-arch" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">4.1 NextGen Architecture</a>
                    <a href="#language-divergence" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">4.2 Language Divergence</a>
                    <a href="#linking-interop" class="block px-3 py-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">4.3 Linking & Interop</a>
                </div>

                <a href="#multilingual-benefits" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">5. Cross-Language LTO</a>
                
                <a href="#advanced-tools" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">6. Advanced Tools</a>
                
                <a href="#conclusion" class="block px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white hover:text-blue-600 hover:shadow-sm transition-all mt-2">7. Conclusion</a>
            </nav>
            
            <div class="p-4 border-t border-slate-200 bg-slate-50 text-xs text-slate-400 text-center">
                Generated based on Research Plan ID: 3efaba21
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-72 w-full max-w-5xl mx-auto p-6 lg:p-12 prose prose-slate">
            
            <!-- Section 1 -->
            <section id="introduction">
                <h1>Every Developer's Guide to LLVM</h1>
                <p class="lead text-xl text-slate-500 mb-8">The Universal Compiler Infrastructure</p>
                
                <p>In the evolving landscape of software engineering, few technologies have fundamentally reshaped the trajectory of programming language implementation, optimization, and cross-platform development as profoundly as <a href="https://llvm.org/" target="_blank">LLVM</a>. Once known as the "Low Level Virtual Machine"—a nomenclature that has since been officially abandoned to reflect its expansion far beyond virtual machines—the LLVM project has matured into the universal backbone of modern compiler architecture.</p>

                <p>It is no longer merely a research project from the University of Illinois; it is the industry-standard infrastructure that underpins giants like Apple's <a href="https://www.swift.org/" target="_blank">Swift</a>, <a href="https://www.rust-lang.org/" target="_blank">Rust</a>, and the modern iterations of C++ via <a href="https://clang.llvm.org/" target="_blank">Clang</a>, while simultaneously revitalizing legacy ecosystems like <a href="https://www.embarcadero.com/products/delphi" target="_blank">Delphi</a>.</p>

                <p>For the contemporary developer, LLVM represents a paradigm shift from the monolithic compilers of the past to a modular, decoupled pipeline. Historically, compiler design was plagued by the <strong>"M × N" complexity problem</strong>. To support <em>M</em> source languages (such as C, Fortran, Pascal) across <em>N</em> hardware targets (x86, ARM, PowerPC), developers were forced to implement <em>M × N</em> distinct compilers. LLVM solved this by introducing a unified intermediate representation (IR) that serves as the "Rosetta Stone" of compilation.</p>
            </section>

            <!-- Section 2 -->
            <section id="core-architecture" class="mt-16 pt-16 border-t border-slate-100">
                <h2>2. The Core Architecture: A Design for Modularity</h2>
                <p>The defining characteristic of the LLVM infrastructure is its rigid adherence to a pipeline architecture centered on a canonical intermediate form. This structure enables the "write once, optimize everywhere" philosophy. Unlike the Java Virtual Machine (JVM), which relies on a stack-based bytecode and a heavy runtime environment, LLVM is designed for static compilation, producing standalone native binaries.</p>

                <h3 id="three-phase-pipeline">2.1 The Three-Phase Pipeline</h3>
                <div class="bg-blue-50 p-6 rounded-lg border border-blue-100 mb-6">
                    <p class="font-semibold text-blue-900 mb-2">Architectural Summary</p>
                    <div class="flex flex-col md:flex-row items-center justify-between text-center gap-4 text-sm font-medium text-slate-700">
                        <div class="bg-white p-3 rounded shadow-sm w-full">Frontend<br><span class="text-xs font-normal text-slate-500">(Source &rarr; IR)</span></div>
                        <i class="fas fa-arrow-right hidden md:block text-slate-400"></i>
                        <i class="fas fa-arrow-down md:hidden text-slate-400"></i>
                        <div class="bg-white p-3 rounded shadow-sm w-full border-2 border-blue-200">Optimizer<br><span class="text-xs font-normal text-slate-500">(IR &rarr; Optimized IR)</span></div>
                        <i class="fas fa-arrow-right hidden md:block text-slate-400"></i>
                        <i class="fas fa-arrow-down md:hidden text-slate-400"></i>
                        <div class="bg-white p-3 rounded shadow-sm w-full">Backend<br><span class="text-xs font-normal text-slate-500">(IR &rarr; Machine Code)</span></div>
                    </div>
                </div>

                <h4>2.1.1 The Frontend</h4>
                <p>The frontend is the language-specific component responsible for processing source code. It performs lexical analysis, parsing, and semantic analysis. Examples include:</p>
                <ul>
                    <li><strong><a href="https://clang.llvm.org/" target="_blank">Clang</a>:</strong> The standard frontend for the C family (C, C++, Objective-C).</li>
                    <li><strong>Delphi NextGen:</strong> Embarcadero’s compiler frontend for mobile and Linux platforms.</li>
                    <li><strong><a href="https://github.com/rust-lang/rust" target="_blank">Rustc</a>:</strong> The Rust compiler, utilizing LLVM for high-performance machine code.</li>
                </ul>

                <h4>2.1.2 The Middle-End (The Optimizer)</h4>
                <p>Once the code exists as LLVM IR, it enters the middle-end. This is the domain of the <code>opt</code> tool. The optimizer is completely language-agnostic; it does not know whether the IR it is processing originated from a Delphi class or a Rust struct.</p>

                <h4>2.1.3 The Backend (Code Generator)</h4>
                <p>The backend, driven by the <code>llc</code> tool, translates the optimized LLVM IR into target-specific machine code (assembly or binary object files). It handles instruction selection, register allocation, and instruction scheduling.</p>

                <h3 id="llvm-ir">2.2 The LLVM Intermediate Representation (IR)</h3>
                <p>The LLVM IR is the "universal language" of this ecosystem. It is a strongly typed, RISC-like assembly language that uses <strong><a href="https://en.wikipedia.org/wiki/Static_single_assignment_form" target="_blank">Static Single Assignment (SSA)</a></strong> form.</p>

                <h4>2.2.1 Static Single Assignment (SSA) Form</h4>
                <p>In SSA, every variable is assigned a value exactly once. This immutability simplifies data flow analysis significantly.</p>

                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Mutable Variable (Source)</th>
                                <th>SSA Form (LLVM IR)</th>
                                <th>Benefit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="font-medium">Assignment</td>
                                <td><code>x = 1; x = 2;</code></td>
                                <td><code>%x.1 = 1; %x.2 = 2;</code></td>
                                <td>Eliminates false dependencies.</td>
                            </tr>
                            <tr>
                                <td class="font-medium">Control Flow</td>
                                <td><code>if (c) x=1 else x=2</code></td>
                                <td><code>%x.3 = phi [%x.1, %then], [%x.2, %else]</code></td>
                                <td>Explicit data flow.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4>2.2.2 Three Forms of IR</h4>
                <ol>
                    <li><strong>In-Memory IR:</strong> C++ object graph used by the compiler.</li>
                    <li><strong>On-Disk Bitcode (<code>.bc</code>):</strong> Dense binary serialization for LTO and JIT.</li>
                    <li><strong>Assembly Language (<code>.ll</code>):</strong> Human-readable text representation.</li>
                </ol>

                <h3 id="optimization-pipeline">2.3 The Optimization Pipeline</h3>
                <p>The optimization capability is orchestrated by the <strong>Pass Manager</strong>. Key passes include:</p>
                <ul>
                    <li><strong><code>mem2reg</code> (Promote Memory to Register):</strong> Analyzes stack memory operations and promotes them to SSA registers.</li>
                    <li><strong><code>instcombine</code> (Instruction Combining):</strong> Folds patterns of instructions into simpler operations.</li>
                </ul>
            </section>

            <!-- Section 3 -->
            <section id="toolchain" class="mt-16 pt-16 border-t border-slate-100">
                <h2>3. The LLVM Toolchain: A Breakdown</h2>

                <h3 id="clang-driver">3.1 Clang: The Frontend Driver</h3>
                <p><code>clang</code> is the primary entry point for C, C++, and Objective-C development.</p>
                <div class="bg-slate-800 text-slate-200 rounded p-4 mb-4 font-mono text-sm">
                    <p class="text-slate-400 mb-2"># Generate Human-Readable IR</p>
                    <p>clang -S -emit-llvm source.c -o source.ll</p>
                    <p class="text-slate-400 mt-4 mb-2"># Generate Bitcode</p>
                    <p>clang -c -emit-llvm source.c -o source.bc</p>
                </div>

                <h3 id="llvm-objdump">3.2 llvm-objdump: The Binary Inspector</h3>
                <p><code>llvm-objdump</code> is a powerful utility for analyzing object files and executables, replacing GNU <code>objdump</code>.</p>
                
                <h4>Key Features</h4>
                <ul>
                    <li><strong>Disassembly:</strong> <code>llvm-objdump -d program.o</code> reverses machine code to assembly.</li>
                    <li><strong>Source Interleaving:</strong> <code>llvm-objdump -d -S program.o</code> uses DWARF info to show source code alongside assembly.</li>
                    <li><strong>Symbol Demangling:</strong> The <code>-C</code> flag decodes mangled C++/Rust names (e.g., <code>_ZN3Foo3barEi</code> becomes <code>Foo::bar(int)</code>).</li>
                </ul>

                <h3 id="opt-tool">3.3 Opt: The Modular Optimizer</h3>
                <p>The <code>opt</code> tool allows developers to run specific optimization passes on LLVM bitcode files.</p>
                <pre>opt -passes=mem2reg input.bc -o output.bc</pre>

                <h3 id="llc-compiler">3.4 LLC: The Static Compiler</h3>
                <p><code>llc</code> is the standalone backend. It takes LLVM bitcode and compiles it into assembly language for a specific architecture.</p>
                <pre>llc -march=x86-64 source.bc -o source.s</pre>

                <h3 id="llvm-link">3.5 llvm-link: The Bitcode Linker</h3>
                <p><code>llvm-link</code> merges multiple bitcode files into a single, massive LLVM module, enabling Link Time Optimization (LTO).</p>
            </section>

            <!-- Section 4 -->
            <section id="delphi-llvm" class="mt-16 pt-16 border-t border-slate-100">
                <h2>4. Delphi and LLVM: A Case Study in Modernization</h2>
                <p>The integration of LLVM into the <a href="https://www.embarcadero.com/products/delphi" target="_blank">Delphi ecosystem</a> allowed it to decouple its frontend from the backend, leveraging global community work for code generation.</p>

                <h3 id="nextgen-arch">4.1 The "NextGen" Architecture</h3>
                <p>Embarcadero introduced "NextGen" compilers (like <code>DCCIOSARM</code>) for mobile. These function as a frontend, emitting LLVM IR, which is then compiled to optimized ARM machine code.</p>

                <h3 id="language-divergence">4.2 Language Divergence</h3>
                <p>Adopting LLVM necessitated changes to align with platform conventions:</p>
                <ul>
                    <li><strong>Zero-Based Strings:</strong> Introduced to match LLVM/C conventions, contrasting with classic 1-based Pascal strings.</li>
                    <li><strong>ARC (Automatic Reference Counting):</strong> Initially enforced for mobile but later deprecated in favor of a unified manual memory model (Delphi 10.4+).</li>
                </ul>

                <h3 id="linking-interop">4.3 Linking and Interoperability</h3>
                <p>LLVM enables linking C/C++ object files directly into Delphi applications using the <code>{$L filename.o}</code> directive.</p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 my-4">
                    <p class="font-bold text-yellow-800">Symbol Mangling Tip</p>
                    <p class="text-yellow-700 text-sm">Use <code>llvm-objdump -t</code> to find the exact mangled name of a C++ function (e.g., <code>__Z6myFunci</code>) to declare it correctly in Delphi.</p>
                </div>
            </section>

            <!-- Section 5 -->
            <section id="multilingual-benefits" class="mt-16 pt-16 border-t border-slate-100">
                <h2>5. Multilingual Benefits: Cross-Language LTO</h2>
                <p>LLVM allows for <strong>Cross-Language Link Time Optimization (LTO)</strong>. Since Clang (C++) and rustc (Rust) both emit LLVM Bitcode, the linker can merge these representations.</p>
                
                <h3>The Unified IR Solution</h3>
                <ol>
                    <li>Compile C++ code with <code>-flto</code>.</li>
                    <li>Compile Rust code with <code>-C linker-plugin-lto</code>.</li>
                    <li>The linker merges modules into a unified graph, enabling the optimizer to inline C++ methods directly into Rust functions.</li>
                </ol>

                <h3>ThinLTO vs. FatLTO</h3>
                <p><strong>ThinLTO</strong> is a revolutionary approach used by projects like <a href="https://www.mozilla.org/en-US/firefox/" target="_blank">Firefox</a>. It keeps modules separate but adds a summary index, allowing the linker to import only necessary functions for inlining. This provides performance benefits similar to monolithic LTO but scales to massive projects.</p>
            </section>

            <!-- Section 6 -->
            <section id="advanced-tools" class="mt-16 pt-16 border-t border-slate-100">
                <h2>6. Advanced Tools</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h4 class="mt-0 text-blue-600">llvm-nm</h4>
                        <p class="text-sm">Lists symbols in object files. Essential for diagnosing linking errors.</p>
                        <code class="text-xs bg-slate-100 p-1 rounded">llvm-nm -C --numeric-sort program.o</code>
                    </div>
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h4 class="mt-0 text-blue-600">llvm-ar</h4>
                        <p class="text-sm">Creates and modifies static libraries (archives). Essential for distributing LTO-ready libraries.</p>
                        <code class="text-xs bg-slate-100 p-1 rounded">llvm-ar rcs lib.a obj.o</code>
                    </div>
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h4 class="mt-0 text-blue-600">llvm-bcanalyzer</h4>
                        <p class="text-sm">Provides statistical analysis of bitcode files (instruction counts, block distribution).</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h4 class="mt-0 text-blue-600">lli</h4>
                        <p class="text-sm">The JIT Interpreter. Executes LLVM bitcode directly in memory.</p>
                        <code class="text-xs bg-slate-100 p-1 rounded">lli program.bc</code>
                    </div>
                </div>
            </section>

            <!-- Conclusion -->
            <section id="conclusion" class="mt-16 pt-16 border-t border-slate-100 pb-20">
                <h2>7. Conclusion</h2>
                <p>The ascendancy of LLVM to the status of a universal backbone is a structural shift in the economics of software development. It has lowered the barrier to entry for creating new programming languages while extending the lifespan of existing ones like Delphi.</p>
                <p>Whether debugging a segmentation fault by interleaving DWARF data or architecting a multi-language system, proficiency with LLVM tools—particularly <code>llvm-objdump</code> and the IR syntax—is now foundational literacy for the modern systems programmer.</p>
            </section>

        </main>
    </div>

    <script>
        // Sidebar Toggle for Mobile
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const main = document.querySelector('main');

        menuToggle.addEventListener('click', () => {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                // On mobile, maybe overlay? For now push is fine or slide over
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        });

        // Close sidebar when clicking a link on mobile
        const sidebarLinks = sidebar.querySelectorAll('a');
        sidebarLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 1024) { // lg breakpoint
                    sidebar.classList.add('-translate-x-full');
                }
            });
        });

        // Simple Active State Scroll Spy
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -70% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    sidebarLinks.forEach(link => {
                        link.classList.remove('text-blue-600', 'bg-white', 'shadow-sm');
                        link.classList.add('text-slate-700');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.remove('text-slate-700');
                            link.classList.add('text-blue-600', 'bg-white', 'shadow-sm');
                        }
                    });
                }
            });
        }, observerOptions);

        document.querySelectorAll('section').forEach((section) => {
            observer.observe(section);
        });
    </script>
</body>
</html>